<html>
  <head>
    <title>jschurch</title>
    <script src="../external/scheme2js/runtime.js" type="text/javascript"></script>
    <script src="church-compiler.js" type="text/javascript"></script>
    <script src="../external/jquery-1.7.min.js" type="text/javascript"></script>
    <script src="../scheme-compilers/javascript/random/Alea.js" type="text/javascript"></script>
    <script src="../scheme-compilers/javascript/random/KISS07.js" type="text/javascript"></script>
    <script src="../scheme-compilers/javascript/random/Kybos.js" type="text/javascript"></script>
    <script src="../scheme-compilers/javascript/random/LFIB4.js" type="text/javascript"></script>
    <script src="../scheme-compilers/javascript/random/LFib.js" type="text/javascript"></script>
    <script src="../scheme-compilers/javascript/random/MRG32k3a.js" type="text/javascript"></script>
    <script src="../scheme-compilers/javascript/random/Mash.js" type="text/javascript"></script>
    <script src="../scheme-compilers/javascript/random/Xorshift03.js" type="text/javascript"></script>
    <script src="../scheme-compilers/scheme2js-template.js" type="text/javascript"></script>
    <script src="../scheme-compilers/javascript/math-functions.js" type="text/javascript"></script>
    <script type="text/javascript">
    var compileSchemeToJS = function(schemeCode, compiledCodeHandler) {        
        var url="http://focusedattention.org/scheme2js/scheme2js.php?scheme=" + encodeURIComponent(schemeCode) + "&callback=?";
        $.getJSON(url, null, compiledCodeHandler);
    };

    $(document).ready(function() {

        $('#churchCompile').click(function() {

            // Read Church code 
            churchInputSrc = $("#churchSrc").val();

            // Compile to Scheme using (Javascript version of) Church compiler
            churchInputExpr = sc_read(new sc_StringInputPort("(" + churchInputSrc + ")"));
            schemeExpr = compile(churchInputExpr, null);

            // Wrap Scheme in scheme2js template
            wrappedSchemeExpr = scheme2jsTemplate.supplant({ churchprogram : String(schemeExpr).slice(1,-1) });

            // Compile to js using scheme2js
            compileSchemeToJS(wrappedSchemeExpr, 
                              function(compiledCode){
                                  alert(compiledCode);
                                  // Set output ports
                                  SC_DEFAULT_OUT = new sc_GenericOutputPort(console.log);
                                  SC_ERROR_OUT = SC_DEFAULT_OUT;
                                  // Run compiled file
                                  eval(compiledCode);
                              }
                             );
            
        });
    });
    </script>
  </head>
  <body>
    <h1>jschurch</h1>

    <textarea id="churchSrc" style="width: 500px; height: 150px; display: block">(or (flip) (flip))
    </textarea>

    <input type="submit" id="churchCompile" onClick="javascript: ">
    </input>

    <textarea id="churchSrcCompiled" style="width: 500px; height: 150px; display: block">
    </textarea>

  </body>
</html>
